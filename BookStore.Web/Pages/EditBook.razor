@page "/edit-book/{id:int}"
@using BookStore.Web.Entities
@inject HttpClient Http
@inject NavigationManager NavManager

<h3>Kitabı Düzenle</h3>

@if (editBook == null)
{
    <p>Yükleniyor...</p>
}
else
{
    <div class="mb-3">
        <label>Kitap Adı</label>
        <input class="form-control" @bind="editBook.Title" />
    </div>

    <div class="mb-3">
        <label>Yazar</label>
        <input class="form-control" @bind="editBook.Author" />
    </div>

    <div class="mb-3">
        <label>Fiyat</label>
        <input type="number" class="form-control" @bind="editBook.Price" />
    </div>

    <div class="mb-3">
        <label>Stok Adedi</label>
        <input type="number" class="form-control" @bind="editBook.StockQty" />
    </div>

    <button class="btn btn-warning" @onclick="UpdateBook">Değişiklikleri Kaydet</button>
}

@code {
    [Parameter] public int Id { get; set; } 
    private Book? editBook;

    protected override async Task OnInitializedAsync()
    {
        // OnInitializedAsync'de api/Books/{Id} kullanarak kitabı çekiyoruz (Bu kısım doğru)
        editBook = await Http.GetFromJsonAsync<Book>($"api/Books/{Id}");
    }

    private async Task UpdateBook()
    {
        if (editBook != null)
        {
            // 1. DÜZELTME: URL'den /Bookstore/ kısmını ve baştaki / işaretini siliyoruz.
            // API'ye gönderirken adresi Controller'ın beklediği gibi yapmalıyız. 
            // Genelde PUT istekleri api/Books/{id} şeklindedir:
            var response = await Http.PutAsJsonAsync($"api/Books/{Id}", editBook);

            if (response.IsSuccessStatusCode)
            {
                // 2. DÜZELTME: Yönlendirmede /Bookstore/ ve baştaki / işaretini siliyoruz.
                // base href="/Bookstore/" ayarın sayesinde bu seni doğru yere götürür.
                NavManager.NavigateTo("books"); 
            }
        }
    }
}
